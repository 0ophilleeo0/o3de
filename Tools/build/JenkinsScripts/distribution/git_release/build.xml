<?xml version="1.0" encoding="UTF-8"?>

<project name="package">
    <target name="SplitZip">
        <!--The fileset below is the filter for all source files. This task moves
            all filtered files (aka source) into a separate directory (${GitSrc}), 
            outside the Lumberyard build zip-extracted location (${ExtractBuild})-->
        <move todir="${GitSrc}" includeEmptyDirs="yes" verbose="false">
            <fileset dir="${ExtractBuild}" casesensitive="no">
                <exclude name="/dev/Gems/GameEffectSystem/**"/>
                <exclude name="/dev/Gems/Oculus/**"/>
                <exclude name="/dev/Gems/OpenVR/**"/>
                <exclude name="/dev/Gems/PBSreferenceMaterials/**"/>
                <exclude name="/dev/Gems/Substance/**"/>
                <exclude name="/dev/MultiplayerProject/**"/>
                <exclude name="/dev/MultiplayerSample/**"/>
                <exclude name="/dev/SamplesProject/**"/>
                <exclude name="/dev/Bin64vc142/**"/>
                <exclude name="/dev/Bin64vc141/**"/>
                <exclude name="/dev/Bin64/**"/>
                <!-- BEGIN LYAJAV-395  Prevent packaging of the following restributables that use to be in Bin64 -->
                <exclude name="/dev/Tools/Redistributables/ANGLE/**"/>
                <exclude name="/dev/Tools/Redistributables/D3DCompiler/**"/>
                <exclude name="/dev/Tools/Redistributables/DbgHelp/**"/>
                <exclude name="/dev/Tools/Redistributables/FFMpeg/**"/>
                <exclude name="/dev/Tools/Redistributables/LuaCompiler/**"/>
                <exclude name="/dev/Tools/Redistributables/MSVC90/**"/>
                <exclude name="/dev/Tools/Redistributables/OpenGL32/**"/>
                <exclude name="/dev/Tools/Redistributables/SSLEAY/**"/>
                <!-- END LYAJAV-395 -->
                <exclude name="/3rdParty/**"/>

                <include name="**/*.args"/>
                <include name="**/*.asp"/>
                <include name="**/*.attribute_layout"/>
                <include name="**/*.bat"/>
                <include name="**/*.c"/>
                <include name="**/*.cbc"/>
                <include name="**/*.cfg"/>
                <include name="**/*.chrparams"/>
                <include name="**/*.cmake"/>
                <include name="**/*.cmd"/>
                <include name="**/*.conf"/>
                <include name="**/*.coffee"/>
                <include name="**/*.cpp"/>
                <include name="**/*.cs"/>
                <include name="**/*.csproj"/>
                <include name="**/*.decTest"/>
                <include name="**/*.def"/>
                <include name="**/*.ent"/>
                <include name="**/*.ent_template"/>
                <include name="**/*.env"/>
                <include name="**/*.exportsettings"/>
                <include name="**/*.filters"/>
                <include name="**/*.h"/>
                <include name="**/*.hpp"/>
                <include name="**/*.html"/>
                <include name="**/*.hxx"/>
                <include name="**/*.ignore"/>
                <include name="**/*.import"/>
                <include name="**/*.ini"/>
                <include name="**/*.inl"/>
                <include name="**/*.java"/>
                <include name="**/*.js"/>
                <include name="**/*.json"/>
                <include name="**/*.lua"/>
                <include name="**/*.lua_template"/>
                <include name="**/*.lyr"/>
                <include name="**/*.m"/>
                <include name="**/*.manifest"/>
                <include name="**/*.md"/>
                <include name="**/*.mel"/>
                <include name="**/*.mm"/>
                <include name="**/*.mk"/>
                <include name="**/*.ms"/>
                <include name="**/*.mtl"/>
                <include name="**/*.njsproj"/>
                <include name="**/*.npmignore"/>
                <include name="**/*.p4ignore"/>
                <include name="**/*.plist"/>
                <include name="**/*.prefab"/>
                <include name="**/*.pro"/>
                <include name="**/*.props"/>
                <include name="**/*.py"/>
                <include name="**/*.pyproj"/>
                <include name="**/*.pys"/>
                <include name="**/*.pyw"/>
                <include name="**/*.qml"/>
                <include name="**/*.qmldir"/>
                <include name="**/*.qmltypes"/>
                <include name="**/*.qrc"/>
                <include name="**/*.qss"/>
                <include name="**/*.rc"/>
                <include name="**/*.sct"/>
                <include name="**/*.scss"/>
                <include name="**/*.sh"/>
                <include name="**/*.slice"/>
                <include name="**/*.sln"/>
                <include name="**/*.spec"/>
                <include name="**/*.sql"/>
                <include name="**/*.targets"/>
                <include name="**/*.tcl"/>
                <include name="**/*.tip"/>
                <include name="**/*.ts"/>
                <include name="**/*.txt"/>
                <include name="**/*.TXT"/>
                <include name="**/*.ui"/>
                <include name="**/*.uicanvas"/>
                <include name="**/*.vbs"/>
                <include name="**/*.vcproj"/>
                <include name="**/*.vcxproj"/>
                <include name="**/*.vssscc"/>
                <include name="**/*.waf_files"/>
                <include name="**/*.xbm"/>
                <include name="**/*.xml"/>
                <include name="**/*.xproj"/>
                <include name="**/ChangeLog"/>
                <include name="**/configure"/>
                <include name="**/DEVEL"/>
                <include name="**/lmbr_waf"/>
                <include name="**/makefile"/>
                <include name="**/makefile.appletv"/>
                <include name="**/wscript"/>
                <include name="**/README"/>
                <include name="**/TODO"/>
                <include name="**/waf"/>
            </fileset>
        </move>

        <!--An Ant trick to delete all empty directories from the extract location, where the binaries reside.
            The command recursively deletes everything in a directory, EXCEPT for every file (lol).
            During execution, it will include deleting empty directories (what we are really after).-->
        <delete includeemptydirs="true">
          <fileset dir="${ExtractBuild}" excludes="**/*" />
        </delete>
    </target>
    <target name="ZipBinaries">
        <zip destfile="${ZipDest}"
               basedir="${ZipSrc}"/>
    </target>
    <target name="ExtractPackage">
        <unzip src="${Zipfile}"
               dest="${ExtractDir}"
               overwrite="false"/>
    </target>
</project>